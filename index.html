<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanzas Pro Bs.</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
    
    <style>
        :root { --primary-color: #4361ee; }
        body { background-color: #f4f7fe; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .icon-circle { width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 15px; }
        .card { border-radius: 15px; transition: transform 0.2s; }
        .list-group-item { border: none; margin-bottom: 8px; border-radius: 12px !important; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .item-ingreso { border-left: 5px solid #198754; }
        .item-gasto { border-left: 5px solid #dc3545; }
        .chart-container { position: relative; height: 300px; width: 100%; }
    </style>
</head>
<body>

<div class="container py-4">
    <header class="text-center mb-5">
        <h2 class="fw-bold"><i class="fas fa-chart-line text-primary me-2"></i>Finanzas Pro Bs.</h2>
        <p class="text-muted">Control inteligente de tus ingresos y gastos</p>
    </header>

    <div class="row g-4">
        <div class="col-lg-4">
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body text-center py-4">
                    <h6 class="text-muted text-uppercase small fw-bold mb-3">Balance Neto Disponible</h6>
                    <h1 id="balance" class="fw-bold mb-3">0.00 Bs.</h1>
                    <div class="d-flex justify-content-center gap-2">
                        <button onclick="exportarAExcel()" class="btn btn-success btn-sm px-3">
                            <i class="fas fa-file-excel me-1"></i> Excel
                        </button>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h6 class="fw-bold mb-4 text-center">Distribuci√≥n de Gastos (%)</h6>
                    <div class="chart-container">
                        <canvas id="miGrafico"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body p-4">
                    <form id="transaccion-form" class="row g-3">
                        <div class="col-md-5">
                            <label class="form-label small fw-bold">Descripci√≥n</label>
                            <input type="text" id="nombre" class="form-control" placeholder="Ej. Supermercado" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold">Monto (Bs.)</label>
                            <input type="number" id="monto" class="form-control" placeholder="0.00" step="0.01" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold">Categor√≠a</label>
                            <select id="categoria" class="form-select">
                                <option value="Sueldo">üíµ Sueldo/Ingreso</option>
                                <option value="Comida">üçé Comida</option>
                                <option value="Transporte">üöó Transporte</option>
                                <option value="Vivienda">üè† Vivienda</option>
                                <option value="Entretenimiento">üé¨ Ocio</option>
                                <option value="Medicamentos">üíä Salud</option>
                                <option value="Vestimenta">üëï Vestimenta</option>
                                <option value="Viajes">‚úàÔ∏è Viajes</option>
                                <option value="Otros">üì¶ Otros</option>
                            </select>
                        </div>
                        <div class="col-12 mt-3">
                            <button type="submit" class="btn btn-primary w-100 fw-bold py-2">Registrar Transacci√≥n</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="fw-bold mb-0">Movimientos Recientes</h5>
                <div class="d-flex gap-2">
                    <input type="date" id="filtro-desde" class="form-control form-control-sm">
                    <input type="date" id="filtro-hasta" class="form-control form-control-sm">
                    <button onclick="actualizarIU()" class="btn btn-outline-secondary btn-sm">Filtrar</button>
                </div>
            </div>

            <ul id="lista-transacciones" class="list-group">
                </ul>
        </div>
    </div>
</div>

<script>
   const firebaseConfig = {

  apiKey: "AIzaSyB763s-tWMVvNa0c9WWHyMDeWU_ANE0_5k",

  authDomain: "mis-finanzas-chalo.firebaseapp.com",

  projectId: "mis-finanzas-chalo",

  storageBucket: "mis-finanzas-chalo.firebasestorage.app",

  messagingSenderId: "912672308730",

  appId: "1:912672308730:web:3fa09e7e9c14645a25f843",

  measurementId: "G-FHDD6GYS8P"

};


    // Configuraci√≥n visual
    const configCategorias = {
        'Sueldo': { icon: 'fa-money-bill-trend-up', color: 'bg-success text-white', colorHex: '#198754' },
        'Comida': { icon: 'fa-utensils', color: 'bg-warning text-dark', colorHex: '#ffc107' },
        'Transporte': { icon: 'fa-car', color: 'bg-info text-white', colorHex: '#eccaf0' },
        'Vivienda': { icon: 'fa-house', color: 'bg-danger text-white', colorHex: '#dc3545' },
        'Entretenimiento': { icon: 'fa-gamepad', color: 'bg-primary text-white', colorHex: '#0d6efd' },
        'Medicamentos': { icon: 'fa-heart-pulse', color: 'bg-info text-white', colorHex: '#0dcaf0' },
        'Vestimenta': { icon: 'fa-shirt', color: 'bg-secondary text-white', colorHex: '#6c757d' },
        'Viajes': { icon: 'fa-plane', color: 'bg-dark text-white', colorHex: '#6a2529' },
        'Otros': { icon: 'fa-ellipsis', color: 'bg-light text-dark', colorHex: '#449955' }
    };

    let transacciones = JSON.parse(localStorage.getItem('transacciones')) || [];
    let miChart;

    // Manejo del Formulario
    document.getElementById('transaccion-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const t = {
            id: Date.now(),
            nombre: document.getElementById('nombre').value,
            monto: parseFloat(document.getElementById('monto').value),
            categoria: document.getElementById('categoria').value,
            fecha: new Date().toISOString().split('T')[0]
        };
        transacciones.unshift(t); // Agregar al inicio
        guardarYActualizar();
        this.reset();
    });

    function guardarYActualizar() {
        localStorage.setItem('transacciones', JSON.stringify(transacciones));
        actualizarIU();
    }

    function eliminar(id) {
        transacciones = transacciones.filter(t => t.id !== id);
        guardarYActualizar();
    }

    function actualizarIU() {
        const lista = document.getElementById('lista-transacciones');
        const balanceEl = document.getElementById('balance');
        lista.innerHTML = '';
        
        let total = 0;
        
        transacciones.forEach(t => {
            const esIngreso = t.categoria === 'Sueldo';
            total += esIngreso ? t.monto : -t.monto;
            const config = configCategorias[t.categoria] || configCategorias['Otros'];

            lista.innerHTML += `
                <li class="list-group-item d-flex align-items-center justify-content-between ${esIngreso ? 'item-ingreso' : 'item-gasto'}">
                    <div class="d-flex align-items-center">
                        <div class="icon-circle ${config.color}">
                            <i class="fas ${config.icon}"></i>
                        </div>
                        <div>
                            <div class="fw-bold">${t.nombre}</div>
                            <small class="text-muted">${t.fecha} ‚Ä¢ ${t.categoria}</small>
                        </div>
                    </div>
                    <div class="text-end">
                        <div class="fw-bold ${esIngreso ? 'text-success' : 'text-danger'}">
                            ${esIngreso ? '+' : '-'}${t.monto.toFixed(2)} Bs.
                        </div>
                        <button onclick="eliminar(${t.id})" class="btn btn-sm text-muted opacity-50"><i class="fas fa-trash"></i></button>
                    </div>
                </li>`;
        });

        balanceEl.innerText = `${total.toFixed(2)} Bs.`;
        balanceEl.style.color = total >= 0 ? '#198754' : '#dc3545';
        actualizarGrafico();
    }

    function actualizarGrafico() {
        const ctx = document.getElementById('miGrafico').getContext('2d');
        
        // Agrupar gastos
        const gastos = transacciones.filter(t => t.categoria !== 'Sueldo');
        const resumen = gastos.reduce((acc, t) => {
            acc[t.categoria] = (acc[t.categoria] || 0) + t.monto;
            return acc;
        }, {});

        const data = {
            labels: Object.keys(resumen),
            datasets: [{
                data: Object.values(resumen),
                backgroundColor: Object.keys(resumen).map(cat => configCategorias[cat]?.colorHex || '#ccc'),
                hoverOffset: 20
            }]
        };

        if (miChart) miChart.destroy();

        miChart = new Chart(ctx, {
            type: 'pie',
            data: data,
            options: {
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { boxWidth: 12, font: { size: 11 } } },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const totalGastos = context.dataset.data.reduce((a, b) => a + b, 0);
                                const porcentaje = ((context.raw / totalGastos) * 100).toFixed(1);
                                return `${context.label}: ${context.raw} Bs. (${porcentaje}%)`;
                            }
                        }
                    }
                }
            }
        });
    }

    function exportarAExcel() {
        const ws = XLSX.utils.json_to_sheet(transacciones);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Transacciones");
        XLSX.writeFile(wb, "Mis_Finanzas.xlsx");
    }

    // Inicio
    actualizarIU();
</script>
</body>
</html>